let userName="";window.addEventListener("DOMContentLoaded",()=>{var e=JSON.parse(localStorage.getItem("user"));e&&firebase.auth().signInWithEmailAndPassword(e.email,e.password).then(e=>{e=e.user;console.log("User logged in:",e),showLoggedInInterface(),getUserInfo(e.uid).then(e=>{e?showUserInfo(e.firstName,e.lastName):console.log("User info not found")})}).catch(e=>{console.error("Login error:",e.message)})});const openModalBtn=document.querySelector(".open_reg-modal"),modal=document.querySelector(".modal"),closeModalBtn=document.querySelector(".modal__close-btn"),regNodde=document.querySelector(".modal__sign-up"),loginNode=document.querySelector(".modal__sign-in"),linkToRegNode=document.querySelector(".modal-register-btn"),linkToLoginNode=document.querySelector(".modal-login-btn"),loader=document.querySelector(".loader-box");function openModal(){modal.classList.add("open")}function closeModal(){modal.classList.remove("open")}openModalBtn.addEventListener("click",function(e){e.preventDefault(),openModal()}),closeModalBtn.addEventListener("click",function(e){e.preventDefault(),closeModal()}),linkToRegNode.addEventListener("click",function(e){e.preventDefault(),loginNode.classList.add("hide"),regNodde.classList.remove("hide")}),linkToLoginNode.addEventListener("click",function(e){e.preventDefault(),regNodde.classList.add("hide"),loginNode.classList.remove("hide")});const closeMenu=document.querySelector(".header_close_btn"),headerNode=document.querySelector(".header"),openMunuNode=document.querySelector(".open__menu-btn");function closeMenuFunc(){headerNode.classList.remove("look")}function openMenuFunc(){headerNode.classList.add("look")}function showLoader(){loader.classList.remove("hide")}function hideLoader(){loader.classList.add("hide")}closeMenu.addEventListener("click",()=>{closeMenuFunc()}),openMunuNode.addEventListener("click",()=>{openMenuFunc()});import{initializeApp}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";import{getAuth,createUserWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js";const firebaseConfig={apiKey:"AIzaSyBH0JKKgglFZUriWv1uhnr9ZSiw6M-6i7Q",authDomain:"my-blog-9045c.firebaseapp.com",projectId:"my-blog-9045c",storageBucket:"my-blog-9045c.appspot.com",messagingSenderId:"569888142571",appId:"1:569888142571:web:01604044d1a496c6d47aae"},app=initializeApp(firebaseConfig),signupBtnNode=(firebase.initializeApp(firebaseConfig),document.querySelector("#signupbtn")),inputBox=document.querySelector("#inputbox"),logoutBtn=document.querySelector("#logout");function showLoggedInInterface(){signupBtnNode.classList.add("hide"),inputBox.classList.remove("hide"),logoutBtn.classList.remove("hide")}function showLogoutInInterface(){signupBtnNode.classList.remove("hide"),inputBox.classList.add("hide"),logoutBtn.classList.add("hide")}function getUserInfo(e){return firebase.firestore().collection("users").doc(e).get().then(e=>e.exists?e.data():(console.log("No such document!"),null)).catch(e=>(console.log("Error getting document:",e),hideLoader(),null))}function showUserInfo(e,o){document.getElementById("userInfo").innerHTML=`Привіт, ${e} ${o}!`,userName=e+"  "+o}let regBtn=document.querySelector("#register");function register(){var e=document.querySelector("#registerPost").value,o=document.querySelector("#registerPassw").value,t=document.querySelector("#firstName").value,n=document.querySelector("#lastName").value;{var s=e,r=o,a=t,i=n;const d=firebase.auth(),l=firebase.firestore();showLoader(),console.log(s,r,a,i),new Promise((t,n)=>{d.createUserWithEmailAndPassword(s,r).then(e=>{var o=e.user;console.log("User registered:",o),closeModal(),localStorage.setItem("user",JSON.stringify({email:s,password:r})),firebase.auth().onAuthStateChanged(function(e){e?(console.log("User is logged in"),showLoggedInInterface(),getUserInfo(e.uid).then(e=>{e?showUserInfo(e.firstName,e.lastName):console.log("User info not found")})):console.log("User is not logged in")}),l.collection("users").doc(o.uid).set({firstName:a,lastName:i,email:s}).then(()=>{console.log("User data saved to database"),hideLoader(),t(e)}).catch(e=>{console.error("Error saving user data to database:",e.message),n(e)})}).catch(e=>{console.error("Registration error:",e.message),hideLoader(),n(e)})})}}regBtn.addEventListener("click",function(e){e.preventDefault(),register()}),document.getElementById("login-btn").addEventListener("click",function(e){e.preventDefault();const o=document.getElementById("login-mail").value,t=document.getElementById("login-pass").value;showLoader(),firebase.auth().signInWithEmailAndPassword(o,t).then(e=>{e=e.user;console.log("User logged in:",e),showLoggedInInterface(),localStorage.setItem("user",JSON.stringify({email:o,password:t})),closeModal(),getUserInfo(e.uid).then(e=>{e?showUserInfo(e.firstName,e.lastName):console.log("User info not found")}),hideLoader()}).catch(e=>{console.error("Login error:",e.message),alert("Login error: "+e.message),hideLoader()})}),document.getElementById("logout").addEventListener("click",function(){showLoader(),firebase.auth().signOut().then(()=>{console.log("User logged out"),localStorage.removeItem("user"),showLogoutInInterface(),document.getElementById("userInfo").innerHTML="",hideLoader()}).catch(e=>{console.error("Logout error:",e.message),alert("Logout error: "+e.message)})});const db=firebase.firestore(),postsRef=db.collection("posts");function getPosts(){var e=firebase.firestore().collection("posts");showLoader(),e.get().then(e=>{let t="";e.forEach(e=>{var o=e.data(),e=(e.id,`
            <li>
            <p>${o.title}</p>
            <div class="date">
            
              <div>${o.timestamp}</div>
              <div>${o.userName}</div>
            </div>
          </li>
            `);t+=e}),document.querySelector(".posts").innerHTML=t,hideLoader()}).catch(e=>{console.error("Error getting posts:",e)})}document.querySelector(".input__btn").addEventListener("click",function(e){e.preventDefault();var e=document.querySelector(".input").value,o=firebase.firestore.Timestamp.now().toDate(),t=o.getDate(),n=o.getMonth()+1,s=o.getFullYear(),r=o.getHours(),o=o.getMinutes(),t=t<10?"0"+t:t,n=n<10?"0"+n:n;postsRef.add({title:e,userName:userName,timestamp:t+`.${n}.${s}  ${r}:`+o,createdAt:firebase.firestore.FieldValue.serverTimestamp()}).then(e=>{console.log("Post added with ID: ",e.id),getPosts(),document.querySelector(".input").value=""}).catch(e=>{console.error("Error adding post: ",e)})}),document.addEventListener("DOMContentLoaded",getPosts);